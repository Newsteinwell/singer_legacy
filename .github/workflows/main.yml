name: ğŸ§ª åŸºç¡€CI (ä»£ç æ£€æŸ¥ä¸å•å…ƒæµ‹è¯•)

on: # è§¦å‘æ¡ä»¶
  push: # æ¨é€ä»£ç æ—¶è§¦å‘
    branches: [ main, feature_* ] # å¯æ ¹æ®éœ€è¦å¢å‡åˆ†æ”¯
  pull_request: # åˆ›å»ºæˆ–æ›´æ–°PRæ—¶è§¦å‘
    branches: [ main ]

jobs:
  test: # åªæœ‰ä¸€ä¸ªåä¸ºâ€œtestâ€çš„ä»»åŠ¡
    runs-on: ubuntu-latest # ä½¿ç”¨GitHubæä¾›çš„æœ€æ–°ç‰ˆUbuntuè™šæ‹Ÿæœº
    strategy:
      matrix: # æµ‹è¯•çŸ©é˜µï¼Œè¿™é‡Œå®šä¹‰Pythonç‰ˆæœ¬
        python-version: ['3.12', '3.13'] # å¯ä¿®æ”¹ä¸ºä½ é¡¹ç›®æ”¯æŒçš„ç‰ˆæœ¬

    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    # 2. è®¾ç½®Pythonç¯å¢ƒ
    - name: ğŸ è®¾ç½® Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip' # å¯ç”¨pipç¼“å­˜ï¼ŒåŠ é€Ÿä¾èµ–å®‰è£…

    # 3. å®‰è£…é¡¹ç›®ä¾èµ–
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        pip install --upgrade pip
        # å‡è®¾ä½ çš„é¡¹ç›®ä¾èµ–å®šä¹‰åœ¨ requirements.txt æˆ– pyproject.toml ä¸­
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        if [ -f pyproject.toml ]; then pip install -e .; fi
        # å®‰è£…å¼€å‘å·¥å…·
        pip install black flake8 pytest pytest-cov

    # 4. ä»£ç é£æ ¼æ£€æŸ¥ (Black)
    - name: ğŸ–¤ ä½¿ç”¨ Black æ£€æŸ¥ä»£ç æ ¼å¼
      run: |
        black --check --diff .

    # 5. ä»£ç è§„èŒƒæ£€æŸ¥ (Flake8)
    - name: ğŸ‘€ ä½¿ç”¨ Flake8 è¿›è¡Œä»£ç è§„èŒƒæ£€æŸ¥
      run: |
        flake8 . --count --show-source --statistics

    # 6. è¿è¡Œå•å…ƒæµ‹è¯•å¹¶æ”¶é›†è¦†ç›–ç‡
    # - name: âœ… ä½¿ç”¨ Pytest è¿è¡Œå•å…ƒæµ‹è¯•
    #   run: |
    #     pytest tests/ -v --cov=./ --cov-report=xml --cov-report=term-missing
    #   # å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œç»§ç»­ç”ŸæˆæŠ¥å‘Šï¼Œä½†æ•´ä¸ªJobä¼šå¤±è´¥
    #   continue-on-error: false

    # 7. (å¯é€‰) ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šåˆ° Codecov
    # - name: ğŸ“¤ ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Šåˆ° Codecov
    #   uses: codecov/codecov-action@v3
    #   with:
    #     file: ./coverage.xml # è¦†ç›–ç‡æ–‡ä»¶è·¯å¾„
    #     fail_ci_if_error: false # å³ä½¿ä¸Šä¼ å¤±è´¥ä¹Ÿä¸é˜»å¡CI
